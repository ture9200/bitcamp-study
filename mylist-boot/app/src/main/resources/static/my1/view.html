<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>프로젝트1</title>
  </head>
  <body>
    <h1>음식 메뉴 보기</h1>
    <form>
      이름*: <input id="x-name" type= "text"> <br>
      가격*: <input id="x-price"type= "text"> <br>
      종류*: <input id="x-type" type = "text"> <br>
      대/중/소: <input id="x-size" type="text"> <br>
      * 별표항목은 필수 입력 항목입니다. * <br>
      <button id ="x-update" type = "button"> 변경 </button>
      <button id ="x-minus" type = "button"> 삭제 </button>
      <button id="x-cancel" type="button"> 취소 </button>
    </form>

    <script type="text/javascript">

    var arr= location.href.split("?");
    console.log(arr);
    if(arr. length == 1) {
      alert ("요청 형식이 올바르지 않습니다.")
      throw "URL 형식 오류!" ;
    }
    var qs =arr[1];
    console.log(qs);

    //2) 쿼리 스트링에서 이메일 값을 추출한다.
    var params = new URLSearchParams(qs);
    var name=params.get("name");

    if (name == null) {
      alert("이름 값이 없습니다.");
      throw "파라미터 오류!";
    }
    console.log(name);

       var Name= document.querySelector("#x-name");
       var Price=document.querySelector("#x-price");
       var Type= document.querySelector("#x-type");
       var Size= document.querySelector("#x-size");

       fetch(`/food/get?name=${name}`)
       .then(function(response) {
         return response.text();

       })

       .then(function(food) {
         var values = food.split(",");

       //4) 연락처 상세 정보를 화면에 출력한다.
       Name.value = values[0];
       Price.value = values[1];
       Type.value = values[2];
       Size.value = values[3];
       });

       document. querySelector("#x-update").onclick=function() {
         if(Name. value == "" || Price.value== "" || Type.value == "") {
           window.alert("필수 입력 항목이 비어 있습니다.");
           return;
         }

         fetch(`/food/update?name=${Name.value}&price=${Price.value}&type=${Type.value}&size=${Size.value}`)
         .then(function(response) {
           return response.text(); //json 형식 문자열 => 자바스크립트 문자열 객체
         })
         .then(function(text) {
           console.log(text);
           location.href ="index.html" ;
         });
       };

       // document. querySelector("#x-cancel").onclick=function() {
       //   location.href = "index.html" ;
       // };

       document.getElementById('x-cancel').addEventListener('click',() =>{
       // document. querySelector("#x-minus").onclick=function() {
         location.href = "index.html" ;
       },false);

       document. querySelector("#x-minus").onclick= function() {
         fetch(`/food/minus?name=${name}`)
         .then(function(response) {
           return response.json();
         })
         .then(function(result) {
           console.log(result);
           location.href="index.html";
         });
       };

       </script>

       </body>
</html>
